#!/bin/bash
# View from remote network: {"meta":{"data":"CuoSCq8KCiC2m+RjFSEFsxuQ9hmD2H714knnDZ2nAx/VzJvm7h/JpBKKCgqjAhJmCgpfbGlmZWN5Y2xlElgKKAoibmFtZXNwYWNlcy9maWVsZHMvaW50ZXJvcC9TZXF1ZW5jZRICCAYKLAombmFtZXNwYWNlcy9maWVsZHMvc2ltcGxlc3RhdGUvU2VxdWVuY2USAggDEn4KB2ludGVyb3AScwoeChgAYWNjZXNzQ29udHJvbABuZXR3b3JrMQASAggSChsKFQBtZW1iZXJzaGlwAG5ldHdvcmsxABICCBYKFgoQAPSPv79pbml0aWFsaXplZBICCAcKHAoWZTJlQ29uZmlkZW50aWFsaXR5RmxhZxICCAcSOQoLc2ltcGxlc3RhdGUSKgoWChAA9I+/v2luaXRpYWxpemVkEgIIBAoQCghBcmN0dXJ1cxIECAgQAxrTBwjIARrNBwoGMTcuNjcxEjtsb2NhbGhvc3Q6OTA4My9uZXR3b3JrMi9teWNoYW5uZWw6c2ltcGxlc3RhdGU6UmVhZDpBcmN0dXJ1cyLfBi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlDVVRDQ0FmZWdBd0lCQWdJVVBEd2JzRnZ5WDFNckNkWG9ybVp1b1B6ekx3WXdDZ1lJS29aSXpqMEVBd0l3CmNqRUxNQWtHQTFVRUJoTUNWVk14RnpBVkJnTlZCQWdURGs1dmNuUm9JRU5oY205c2FXNWhNUm93R0FZRFZRUUsKRXhGdmNtY3hMbTVsZEhkdmNtc3hMbU52YlRFUE1BMEdBMVVFQ3hNR1JtRmljbWxqTVIwd0d3WURWUVFERXhSagpZUzV2Y21jeExtNWxkSGR2Y21zeExtTnZiVEFlRncweU1qRXdNVGt4TWpBMk1EQmFGdzB6TWpFd01Ua3dNREV4Ck1EQmFNQ0V4RHpBTkJnTlZCQXNUQm1Oc2FXVnVkREVPTUF3R0ExVUVBeE1GZFhObGNqRXdXVEFUQmdjcWhrak8KUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVR3NVVtQmhaQkpRNEJFMWkvMHFKam1PWHN0bElwR2ZhOWpJVWo3TERmTwo5WjU0WDB6RzdwRmR5VlMxRzhqekZIem5ZcUV3eDNLTDdVZFV0WkphcHUrbm80RzdNSUc0TUE0R0ExVWREd0VCCi93UUVBd0lIZ0RBTUJnTlZIUk1CQWY4RUFqQUFNQjBHQTFVZERnUVdCQlNoMGlzc3d0VVJvTHRZRGFrVmVMMFoKbEJEK0FEQWZCZ05WSFNNRUdEQVdnQlJqbkxmN0lnN1JXV2ZITVNrZ2d4clBNNWhicnpCWUJnZ3FBd1FGQmdjSQpBUVJNZXlKaGRIUnljeUk2ZXlKb1ppNUJabVpwYkdsaGRHbHZiaUk2SWlJc0ltaG1Ma1Z1Y205c2JHMWxiblJKClJDSTZJblZ6WlhJeElpd2lhR1l1Vkhsd1pTSTZJbU5zYVdWdWRDSjlmVEFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlFQTdIOC9HbHRhbzVZenlTV0grWkwyV3pXRmRUa3NIZnV0SXFrbjhwUUpiTWtDSUVSTjlvUjJpWGlyeGtOQwowcDNvNXNJV2VyRkVkSFo3Q1JTZ3VubEp2QzhWCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KKiQ3MzdhOWMyNS1lMTM4LTQ3OWYtOWQ5Yi1jMjg1NjFlNWI0NzUiDBIHaW50ZXJvcBoBMRK1CArpBwoHT3JnMU1TUBLdBy0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlDclRDQ0FsT2dBd0lCQWdJVUE4TUhRR21CTHF0blZaUzBEUzQyRmlFUkpTb3dDZ1lJS29aSXpqMEVBd0l3CmNqRUxNQWtHQTFVRUJoTUNWVk14RnpBVkJnTlZCQWdURGs1dmNuUm9JRU5oY205c2FXNWhNUm93R0FZRFZRUUsKRXhGdmNtY3hMbTVsZEhkdmNtc3lMbU52YlRFUE1BMEdBMVVFQ3hNR1JtRmljbWxqTVIwd0d3WURWUVFERXhSagpZUzV2Y21jeExtNWxkSGR2Y21zeUxtTnZiVEFlRncweU1qRXdNVGt3T1RRNE1EQmFGdzB6TWpFd01UZ3lNVFV6Ck1EQmFNRnN4Q3pBSkJnTlZCQVlUQWxWVE1SY3dGUVlEVlFRSUV3NU9iM0owYUNCRFlYSnZiR2x1WVRFVU1CSUcKQTFVRUNoTUxTSGx3WlhKc1pXUm5aWEl4RFRBTEJnTlZCQXNUQkhCbFpYSXhEakFNQmdOVkJBTVRCWEJsWlhJdwpNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUU3OTl3ZTJaSlI3NHVaZGIvVzdBZWUyclpramVhCnV4VW03cUZMbVZ5ZjlUOVREZ211L3ZXVml4a2RiMEhEdmt4Nm10SUIzcGptSGt3cmZjKzV0bEFUSmFPQjNUQ0IKMmpBT0JnTlZIUThCQWY4RUJBTUNCNEF3REFZRFZSMFRBUUgvQkFJd0FEQWRCZ05WSFE0RUZnUVVGaVNSTmhzZApLdnJaMU9xUzJSMmR2akpmYXhrd0h3WURWUjBqQkJnd0ZvQVUydGdmRDl6LytPd1BYN0FDSExMZTc4SksyWmN3CklnWURWUjBSQkJzd0dZSVhjR1ZsY2pBdWIzSm5NUzV1WlhSM2IzSnJNaTVqYjIwd1ZnWUlLZ01FQlFZSENBRUUKU25zaVlYUjBjbk1pT25zaWFHWXVRV1ptYVd4cFlYUnBiMjRpT2lJaUxDSm9aaTVGYm5KdmJHeHRaVzUwU1VRaQpPaUp3WldWeU1DSXNJbWhtTGxSNWNHVWlPaUp3WldWeUluMTlNQW9HQ0NxR1NNNDlCQU1DQTBnQU1FVUNJUUNFCi94djNOZ3FCa1o4RDA3dFgvZ1lpenorKzdZSFFJU2RVODM2aUkya01Bd0lnRm1XTTUvOUNRb1pKSVh1Ung2angKREdDaTVJdEswL0YxRWtZR3hZcm1rVGs9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KEkcwRQIhAP6hD6aTRu8rFu82ohg41LhJ7xko6fnthwglnGAen/YCAiAnBeQMoMjpZ6WWk1HK4/tvLhJZFhUYYzGNLNYmi3kM7w=="}. Interop Flow result
REQ_JSON="interop_exchange/request-N1.json"
TXID=$(jq -r '.txId' "$REQ_JSON")
SRC_NET=$(jq -r '.sourceNetwork' "$REQ_JSON")
DATA=$(jq -r '.testData' "$REQ_JSON")
REQ_STR="REQ_${TXID}_${SRC_NET}_${DATA}"
./bin/fabric-cli interop --local-network=network1 --requesting-org=Org1MSP "relay-network2:9083/network2/mychannel:simplestate:Create:$REQ_STR"
VIEW_JSON=$(echo "$OUTPUT" | sed -n 's/^View from remote network: //p')
if jq -e . >/dev/null 2>&1 <<<"$VIEW_JSON"; then
jq --argjson view "$VIEW_JSON" '.interopResponse = $view' "$RESP_JSON" > tmp_response.json && mv tmp_response.json "$RESP_JSON"